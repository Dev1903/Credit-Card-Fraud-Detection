<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Card Fraud Detection</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        html {
            scroll-behavior: smooth;
        }
    </style>
</head>

<body>
    <div class="container mt-5">
        <h2 class="text-center">Credit Card Fraud Detection</h2>

        <!-- Manual Input Form -->
        <form id="manualInputForm">
            <h3>Manual Input</h3>
            <a id="toggleFormLink" href="#fileUploadForm"> <b> OR</b> Click here to a batch dataset for testing(.csv
                format)</a>
            <div id="manualFeatures">
                <!-- Create inputs for 28 features -->
                <!-- Repeat the following block 28 times for each feature -->
                <div class="form-group">
                    <label for="feature1">Feature 1</label>
                    <input type="number" step="any" class="form-control" id="feature1" name="feature1" required>
                </div>
                <div class="form-group">
                    <label for="feature2">Feature 2</label>
                    <input type="number" step="any" class="form-control" id="feature2" name="feature2" required>
                </div>
                <div class="form-group">
                    <label for="feature1">Feature 3</label>
                    <input type="number" step="any" class="form-control" id="feature3" name="feature3" required>
                </div>
                <div class="form-group">
                    <label for="feature4">Feature 4</label>
                    <input type="number" step="any" class="form-control" id="feature4" name="feature4" required>
                </div>
                <div class="form-group">
                    <label for="feature5">Feature 5</label>
                    <input type="number" step="any" class="form-control" id="feature5" name="feature5" required>
                </div>
                <div class="form-group">
                    <label for="feature6">Feature 6</label>
                    <input type="number" step="any" class="form-control" id="feature6" name="feature6" required>
                </div>
                <div class="form-group">
                    <label for="feature7">Feature 7</label>
                    <input type="number" step="any" class="form-control" id="feature7" name="feature7" required>
                </div>
                <div class="form-group">
                    <label for="feature8">Feature 8</label>
                    <input type="number" step="any" class="form-control" id="feature8" name="feature8" required>
                </div>
                <div class="form-group">
                    <label for="feature9">Feature 9</label>
                    <input type="number" step="any" class="form-control" id="feature9" name="feature9" required>
                </div>
                <div class="form-group">
                    <label for="feature10">Feature 10</label>
                    <input type="number" step="any" class="form-control" id="feature10" name="feature10" required>
                </div>
                <div class="form-group">
                    <label for="feature11">Feature 11</label>
                    <input type="number" step="any" class="form-control" id="feature11" name="feature11" required>
                </div>
                <div class="form-group">
                    <label for="feature12">Feature 12</label>
                    <input type="number" step="any" class="form-control" id="feature12" name="feature12" required>
                </div>
                <div class="form-group">
                    <label for="feature13">Feature 13</label>
                    <input type="number" step="any" class="form-control" id="feature13" name="feature13" required>
                </div>
                <div class="form-group">
                    <label for="feature14">Feature 14</label>
                    <input type="number" step="any" class="form-control" id="feature14" name="feature14" required>
                </div>
                <div class="form-group">
                    <label for="feature15">Feature 15</label>
                    <input type="number" step="any" class="form-control" id="feature15" name="feature15" required>
                </div>
                <div class="form-group">
                    <label for="feature16">Feature 16</label>
                    <input type="number" step="any" class="form-control" id="feature16" name="feature16" required>
                </div>
                <div class="form-group">
                    <label for="feature17">Feature 17</label>
                    <input type="number" step="any" class="form-control" id="feature17" name="feature17" required>
                </div>
                <div class="form-group">
                    <label for="feature18">Feature 18</label>
                    <input type="number" step="any" class="form-control" id="feature18" name="feature18" required>
                </div>
                <div class="form-group">
                    <label for="feature19">Feature 19</label>
                    <input type="number" step="any" class="form-control" id="feature19" name="feature19" required>
                </div>
                <div class="form-group">
                    <label for="feature20">Feature 20</label>
                    <input type="number" step="any" class="form-control" id="feature20" name="feature20" required>
                </div>
                <div class="form-group">
                    <label for="feature21">Feature 21</label>
                    <input type="number" step="any" class="form-control" id="feature21" name="feature21" required>
                </div>
                <div class="form-group">
                    <label for="feature22">Feature 22</label>
                    <input type="number" step="any" class="form-control" id="feature22" name="feature22" required>
                </div>
                <div class="form-group">
                    <label for="feature23">Feature 23</label>
                    <input type="number" step="any" class="form-control" id="feature23" name="feature23" required>
                </div>
                <div class="form-group">
                    <label for="feature24">Feature 24</label>
                    <input type="number" step="any" class="form-control" id="feature24" name="feature24" required>
                </div>
                <div class="form-group">
                    <label for="feature25">Feature 25</label>
                    <input type="number" step="any" class="form-control" id="feature25" name="feature25" required>
                </div>
                <div class="form-group">
                    <label for="feature26">Feature 26</label>
                    <input type="number" step="any" class="form-control" id="feature26" name="feature26" required>
                </div>
                <div class="form-group">
                    <label for="feature27">Feature 27</label>
                    <input type="number" step="any" class="form-control" id="feature27" name="feature27" required>
                </div>
                <div class="form-group">
                    <label for="feature28">Feature 28</label>
                    <input type="number" step="any" class="form-control" id="feature28" name="feature28" required>
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Detect Fraud</button>
        </form>

        <!-- File Upload Form -->
        <form id="fileUploadForm" enctype="multipart/form-data">
            <h3>Upload Dataset</h3>
            <div class="form-group">
                <label for="file">Choose CSV File</label>
                <input type="file" class="form-control-file" id="file" name="file" accept=".csv" required>
            </div>
            <button type="submit" class="btn btn-primary">Upload and Detect</button>
        </form>

        <div id="result" class="mt-5 pt-5 mb-5 pb-5 text-center"></div>
    </div>

    <script>

        // Handle manual input form submission
        document.getElementById('manualInputForm').addEventListener('submit', async function (event) {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);
            const dataArray = [];

            formData.forEach((value) => dataArray.push(parseFloat(value)));  // Convert values to float

            try {
                const response = await fetch('/detect-fraud', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ features: dataArray })
                });

                if (response.ok) {
                    const result = await response.json();
                    document.getElementById('result').innerHTML = `<div class="alert alert-info">${result.message}</div>`;
                } else {
                    document.getElementById('result').innerHTML = `<div class="alert alert-danger">Error: ${response.statusText}</div>`;
                }
            } catch (error) {
                document.getElementById('result').innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        });

        // Handle file upload form submission
        document.getElementById('fileUploadForm').addEventListener('submit', async function (event) {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);

            try {
                const response = await fetch('/upload-dataset', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const result = await response.json();
                    const downloadLink = document.createElement('a');
                    downloadLink.href = result.file_url;
                    downloadLink.download = 'processed_dataset.csv';
                    downloadLink.click();

                    document.getElementById('result').innerHTML = `<div class="alert alert-info">Dataset processed successfully. <a href="${result.file_url}">Download processed file</a></div>`;
                } else {
                    document.getElementById('result').innerHTML = `<div class="alert alert-danger">Error: ${response.statusText}</div>`;
                }
            } catch (error) {
                document.getElementById('result').innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        });
    </script>
</body>

</html>